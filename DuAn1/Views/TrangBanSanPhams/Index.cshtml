@{
    Layout = "~/Views/Shared/_chitiet.cshtml";
}

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<style>
    .product-list-container {
        width: 100%;
        padding: 20px;
    }

    .product-list-row {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
    }

    .product-card {
        flex: 1 1 calc(33.333% - 15px);
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 6px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        transition: 0.3s;
    }

        .product-card:hover {
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

    .product-card-img {
        width: 100%;
        height: 200px;
        background: #f9f9f9;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
    }

        .product-card-img img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

    .product-card-body {
        padding: 10px 15px;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }

    .product-title {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 8px;
    }

    .product-price {
        font-size: 15px;
        color: #28a745;
        font-weight: bold;
    }

    .product-stock {
        font-size: 14px;
        color: #007bff;
    }

    .product-actions {
        margin-top: 10px;
        display: flex;
        justify-content: space-between;
        gap: 5px;
    }
</style>


<body>
    <!-- Categories Section Begin -->
    <section class="categories">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-6 p-0">
                    <div class="categories__item categories__large__item set-bg"
                         data-setbg="https://img.freepik.com/premium-photo/girl-with-headphones-colorful-background_662214-64312.jpg?w=900">
                        <div class="categories__text">
                            <h1>Women’s headphone</h1>
                            <p>
                                Khám phá thế giới âm thanh tuyệt vời với tai nghe nữ của chúng tôi.
                                Được thiết kế tinh tế, tai nghe này không chỉ mang lại âm thanh chất lượng cao mà còn đảm bảo sự thoải mái khi sử dụng.
                                Với công nghệ tiên tiến, bạn sẽ trải nghiệm từng nốt nhạc rõ nét và sống động.
                            </p>
                            <a asp-controller="TrangBanSanPhams" asp-action="CuaHang" style="text-decoration: none;">Cửa hàng</a>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="row">
                        <div class="col-lg-6 col-md-6 col-sm-6 p-0">
                            <div class="categories__item set-bg" data-setbg="https://png.pngtree.com/thumb_back/fw800/background/20230610/pngtree-the-character-wearing-headphones-with-an-ear-piercing-in-his-head-image_2919756.jpg">
                                <div class="categories__text">
                                    <h4>Men’s headphone</h4>
                            <a asp-controller="TrangBanSanPhams" asp-action="CuaHang" style="text-decoration: none;">Cửa hàng</a>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-6 col-sm-6 p-0">
                            <div class="categories__item set-bg" data-setbg="https://png.pngtree.com/thumb_back/fw800/background/20230516/pngtree-man-wearing-headphones-with-a-picture-of-a-person-with-headphones-image_2563734.jpg">
                                <div class="categories__text">
                                    <h4>Kid’s headphone</h4>
                            <a asp-controller="TrangBanSanPhams" asp-action="CuaHang" style="text-decoration: none;">Cửa hàng</a>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-6 col-sm-6 p-0">
                            <div class="categories__item set-bg" data-setbg="https://png.pngtree.com/thumb_back/fw800/background/20240331/pngtree-beautiful-women-at-sunset-city-listening-music-with-headphone-image_15699607.jpg">
                                <div class="categories__text">
                                    <h4>Beautiful</h4>
                            <a asp-controller="TrangBanSanPhams" asp-action="CuaHang" style="text-decoration: none;">Cửa hàng</a>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-6 col-sm-6 p-0">
                            <div class="categories__item set-bg" data-setbg="https://img.pikbest.com/origin/10/03/27/75npIkbEsTeuQ.jpg!w700wp">
                                <div class="categories__text">
                                    <h4>Headphone</h4>
                            <a asp-controller="TrangBanSanPhams" asp-action="CuaHang" style="text-decoration: none;">Cửa hàng</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Categories Section End -->
    <!-- Danh sách sản phẩm -->
    <div class="product-list-container">
        <div class="product-list-row">
            @foreach (var item in Model)
            {
                <div class="product-card">
                    <div class="product-card-img">
                        <img src="@item.HinhMinhHoa" alt="@item.TenSanPham">
                    </div>
                    <div class="product-card-body">
                        <div>
                            <h5 class="product-title">@item.TenSanPham</h5>
                            <p class="product-price">
                                @if (item.DonGia != null && item.MaKhuyenMaiNavigation?.PhanTramGiam != null && item.MaKhuyenMaiNavigation.TrangThai == "Đang hoạt động")
                                {
                                    var discountedPrice = item.DonGia * (1 - (item.MaKhuyenMaiNavigation.PhanTramGiam / 100));
                                    <span>@String.Format("{0:C0}", discountedPrice)</span>
                                    <span class="text-muted ml-2"><del>@String.Format("{0:C0}", item.DonGia)</del></span>
                                }
                                else
                                {
                                    @String.Format("{0:C0}", item.DonGia)
                                }
                            </p>
                            <p class="product-stock">Số lượng còn: @item.SoLuongTonKho</p>
                        </div>
                        <div class="product-actions">
                            <button class="btn btn-primary btn-sm"
                                    data-toggle="modal"
                                    data-target="#addToCartModal"
                                    data-id="@item.MaSanPham"
                                    data-name="@item.TenSanPham"
                                    data-max="@item.SoLuongTonKho">
                                <i class="fas fa-cart-plus"></i> Thêm vào giỏ
                            </button>
                            <a class="btn btn-info btn-sm" asp-action="Details" asp-route-id="@item.MaSanPham">Chi tiết</a>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
    <div class="modal fade" id="addToCartModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form id="addToCartForm" method="post" asp-action="AddToCart">
                    <div class="modal-header">
                        <h5 class="modal-title">Thêm vào giỏ hàng</h5>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" name="MaSanPham" id="modalMaSanPham" />

                        <p class="mb-1 font-weight-bold" id="modalProductName"></p>
                        <p class="text-muted" id="modalSoLuongCon"></p>

                        <div class="form-group">
                            <label for="SoLuong">Nhập số lượng:</label>
                            <input type="number" name="SoLuong" id="modalSoLuong" class="form-control" value="1" min="1" />
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button id="btnAddCart" type="submit" class="btn btn-success">
                            Thêm
                        </button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script>
        $('#addToCartModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget);
            var id = button.data('id');
            var name = button.data('name');
            var max = button.data('max');

            $('#modalMaSanPham').val(id);
            $('#modalProductName').text("Sản phẩm: " + name);

            if (max > 0) {
                $('#modalSoLuongCon').text("Số lượng còn: " + max);
                $('#modalSoLuong').attr('max', max).val(1).prop('disabled', false);
                $('#btnAddCart').prop('disabled', false).removeClass('btn-secondary').addClass('btn-success');
            } else {
                $('#modalSoLuongCon').text("Sản phẩm đã hết hàng");
                $('#modalSoLuong').val(0).prop('disabled', true);
                $('#btnAddCart').prop('disabled', true).removeClass('btn-success').addClass('btn-secondary');
            }
        });
    </script>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>